<system>
  log_level debug
</system>

<source>
  @type tail
  path /dionaea/lib/dionaea/dionaea_output.json
  pos_file /dionaea/lib/dionaea/log.pos
  tag dionaea
  format json
  <parse>
    @type json
  </parse>
</source>

<match dionaea>
  @type elasticsearch
  host cynergizer-ce1e21.es.us-central1.gcp.cloud.es.io
  port 9243
  scheme https
  index_name 62558e285529969891a081a3`dionaea_requests
  user elastic
  password j1UnCKApb2N5VWU8wZmueUOK
</match>

<source>
  @type tail
  path /opt/tanner/tanner_report.json
  pos_file /opt/tanner/log.json.pos
  tag tanner
  format json
</source>

<filter tanner>
  @type record_transformer
  enable_ruby
  auto_typecast yes
  <record>
    attackerIP ${record["headers"]["x-forwarded-for"]}
    port ${record.dig("peer", "port")}
    type ${"1"}
    post_data_1 ${record.dig("post_data", "email")}
    post_data_2 ${record.dig("post_data", "content")}
    detection ${record.dig("response_msg", "response", "message", "detection", "name")}
  </record>
</filter>

<filter tanner>
  @type rename_key
  rename_rule2 timestamp datetime
  rename_rule3 path payload
</filter>

<filter tanner>
  @type record_transformer
  remove_keys method,headers,uuid,peer,status,cookies,post_data,response_msg,timestamp
</filter>

<match tanner>
  @type elasticsearch
  host cynergizer-ce1e21.es.us-central1.gcp.cloud.es.io
  port 9243
  scheme https
  index_name 62558e285529969891a081a3`web_requests
  user elastic
  password j1UnCKApb2N5VWU8wZmueUOK
</match>

<source>
  @type tail
  path /opt/cowrie/log/cowrie.json
  pos_file /opt/cowrie/log/log.pos
  tag cowrie
  format json
</source>

<match cowrie>
  @type elasticsearch
  host cynergizer-ce1e21.es.us-central1.gcp.cloud.es.io
  port 9243
  scheme https
  index_name 62558e285529969891a081a3`cowrie_requests
  user elastic
  password j1UnCKApb2N5VWU8wZmueUOK
</match>

<source>
  @type tail
  path /var/log/kern.json
  pos_file /var/log/log.pos
  tag iptable
  format json
</source>

<filter iptable>
  @type rename_key
  rename_rule4 dpt d_port
  rename_rule5 proto protocol
  rename_rule6 src source_ip
  rename_rule7 date_time datetime
</filter>

<filter iptable>
  @type record_transformer
  remove_keys source,spt,dst,len
</filter>

<match iptable>
  @type elasticsearch
  host cynergizer-ce1e21.es.us-central1.gcp.cloud.es.io
  port 9243
  scheme https
  index_name 62558e285529969891a081a3`iptable_requests
  user elastic
  password j1UnCKApb2N5VWU8wZmueUOK
</match>
